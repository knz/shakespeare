role road
  :car  if test -e blocked; then \
          echo "car stopped"; \
        else \
          echo "car rides"; \
        fi >>traffic.log
  spotlight touch traffic.log; tail -F traffic.log
  signal ride event at (?P<ts_now>)(?P<event>car rides)
  signal stop event at (?P<ts_now>)(?P<event>car stopped)
  cleanup   rm -f traffic.log
end

role redlight
  :red   touch ../$road/blocked
  :green rm -f ../$road/blocked
end

cast
  myroad plays road
  mylight plays redlight(road=myroad)
end

script
  tempo 100ms
  action . entails nop
  action c entails :car
  action r entails :red; mood red
  action g entails :green; mood clear
  prompt myroad  ....c...c..c..c..c..c..c...
  prompt mylight ..r...g...r...g...r...g....
end

audience
  observer watches myroad ride
  observer watches myroad stop
end
