role node
  :start test -e surl || mkfifo surl; export TMPDIR=/tmp; \
			$COCKROACH start --insecure --background \\
					   --join=$peers --port=$p --http-port=$h \\
					   --pid-file=pid --listening-url-file=surl \\
					   >start.log 2>&1
  :init $COCKROACH init --insecure --port=$p; res=$?; cat surl; exit $res
  :reset kill $(cat pid) && sleep 1 && kill -9 $(cat pid) || true; rm -rf cockroach-data
  cleanup if test -e pid; then kill $(cat pid) && sleep 1 && kill -9 $(cat pid) || true; fi
  spotlight tail -F cockroach-data/logs/cockroach.log | \
  		  stdbuf -oL grep '^[WEF]' | \
		  stdbuf -oL grep -v 'server is not accepting clients'
  signal   warning event at ^W(?P<ts_log>)\s+\d+\s+\S+\s+(?P<event>.*)$
  signal   error event at  ^E(?P<ts_log>)\s+\d+\s+\S+\s+(?P<event>.*)$
  signal   fatal event at  ^F(?P<ts_log>)\s+\d+\s+\S+\s+(?P<event>.*)$
end

